ifelse(
df$ANY_RADIATION == "Radiation" &
df$DX_RAD_STARTED_DAYS < df$DX_RX_STARTED_DAYS,
2,
3
)
)
)
df$NEOADJUVANTRT <-
factor(
df$NEOADJUVANTRT,
levels = c(0, 1, 2, 3),
labels = c("Radiation + No Surgery",
"Neoadjuvant Radiation",
"Adjuvant Radiation",
"NA")
)
var_label(df$NEOADJUVANTRT) <- "Neo/adjuvant Radiation Treatment"
################## OUTCOMES     ##########################
### PUF_30_DAY_MORT_CD - Thirty Day Mortality
# This item indicates mortality within 30 days of the most definitive primary site
# surgery
df$PUF_30_DAY_MORT_CD <-
factor(
df$PUF_30_DAY_MORT_CD,
levels = c(0, 1, 9),
labels = c(
"Patient alive, or died more than 30 days after surgery performed",
"Patient died 30 or fewer days after surgery performed",
"Patient alive with fewer than 30 days of follow-up, surgery date missing, or last contact date missing"
)
)
var_label(df$PUF_30_DAY_MORT_CD) <- "30-day Mortality"
### PUF_90_DAY_MORT_CD - Nintey day mortality
# This item indicates mortality within 90 days after the most definitive primary site
# surgery
df$PUF_90_DAY_MORT_CD <-
factor(
df$PUF_90_DAY_MORT_CD,
levels = c(0, 1, 9),
labels = c(
"Patient alive, or died more than 90 days after surgery performed",
"Patient died 90 or fewer days after surgery performed",
"Patient alive with fewer than 90 days of follow-up, surgery date missing, or last contact date missing"
)
)
var_label(df$PUF_90_DAY_MORT_CD) <- "90-day Mortality"
### DX_LASTCONTACT_DEATH_MONTHS - Last contact or death, months from dx
# The number of months between the date of diagnosis (NAACCR Item #390) and
# the date on which the patient was last contacted or died (NAACCR Item #1750).
### PUF_VITAL_STATUS - PUF Vital Status
# Records the vital status of the patient as of the date entered in Date of Last Contact
# or Death (NAACCR Item #1750), which is the status of the patient at the end of
# Elapsed Months Date of Diagnosis to Date of Last Contact or Death in the PUF.
# Loop through rows and run the recodeStatus function
df$PUF_VITAL_STATUS <-
factor(
df$PUF_VITAL_STATUS,
levels = c(0, 1),
labels = c("Dead",
"Alive")
)
df$RECODED_STATUS <- NA
df$RECODED_STATUS[df$PUF_VITAL_STATUS == "Dead"] <-
1
df$RECODED_STATUS[df$PUF_VITAL_STATUS == "Alive"] <-
0
#### OUTPUT ####
#returns recoded dataframe
df
}
# Load Master tumor list and libraries
library(readxl)
library(dplyr)
library(xlsx)
library(labelled)
#allTumors <- read_excel("C:/Users/samra/Google Drive/RUSH/Research/ENT/Databases/Master NCDB Recode_AG120518.xlsx")
df <-
read_excel(
#"W:/Google Drive/RUSH/Research/ENT/Databases/Raw Sinonasal NCDB Data.xlsx"
"C:/Users/samra/Google Drive/RUSH/Research/ENT/Databases/Raw Sinonasal NCDB Data.xlsx"
)
newdf <- NCDBRecode(df)
newdf
View(newdf)
summary(df$YEAR_OF_DIAGNOSIS)
summary(df$FACILITY_TYPE_CD)
summary(as.factor(df$FACILITY_TYPE_CD))
summary(as.factor(newdf$FACILITY_TYPE_CD))
df <-
read_excel(
#"W:/Google Drive/RUSH/Research/ENT/Databases/Raw Sinonasal NCDB Data.xlsx"
# "C:/Users/samra/Google Drive/RUSH/Research/ENT/Databases/Raw Sinonasal NCDB Data.xlsx"
"C:/Users/samra/Google Drive/RUSH/Research/ENT/Databases/NCDB 2004-2016 All Files/Tonsil.sav"
)
df
newdf
library(readspss)
install.packages("read.spss")
install.packages("readspss")
library(read.spss)
library(readspss)
library(haven)
library(haven)
df <- read_spss("C:/Users/samra/Google Drive/RUSH/Research/ENT/Databases/NCDB 2004-2016 All Files/Tonsil.sav")
df
summary(as.factor(df$FACILITY_TYPE_CD))
df <- read_spss("C:/Users/samra/Google Drive/RUSH/Research/ENT/Databases/NCDB 2004-2016 All Files/Tongue
")
df <- read_spss("C:/Users/samra/Google Drive/RUSH/Research/ENT/Databases/NCDB 2004-2016 All Files/Tongue.sav")
summary(as.factor(df$FACILITY_TYPE_CD))
df <- read_spss("C:/Users/samra/Google Drive/RUSH/Research/ENT/Databases/NCDB 2004-2016 All Files/Pharynx.sav")
summary(as.factor(df$FACILITY_TYPE_CD))
df$FACILITY_TYPE_CD <-
factor(
df$FACILITY_TYPE_CD,
levels = c(1, 2, 3, 4),
labels = c(
"Community Cancer Program",
"Comprehensive Community Cancer Program",
"Academic/Research Program (includes NCI-designated comprehensive cancer centers)",
"Integrated Network Cancer Program"
)
)
warnings()
summary(as.factor(df$FACILITY_TYPE_CD))
summary(as.factor(df$FACILITY_LOCATION_CD))
df$FACILITY_LOCATION_CD <-
factor(
df$FACILITY_LOCATION_CD,
levels = c(1, 2, 3, 4, 5, 6, 7, 8, 9),
labels = c(
"New England",
"Middle Atlantic",
"South Atlantic",
"East North Central",
"East South Central",
"West North Central",
"West South Central",
"Mountain",
"Pacific",
"Out of US (All other values)"
)
)
var_label(df$FACILITY_LOCATION_CD) <- "Facility Location"
df$FACILITY_LOCATION_CD <-
factor(
df$FACILITY_LOCATION_CD,
levels = c(1, 2, 3, 4, 5, 6, 7, 8, 9),
labels = c(
"New England",
"Middle Atlantic",
"South Atlantic",
"East North Central",
"East South Central",
"West North Central",
"West South Central",
"Mountain",
"Pacific",
)
)
var_label(df$FACILITY_LOCATION_CD) <- "Facility Location"
df$FACILITY_LOCATION_CD <-
factor(
df$FACILITY_LOCATION_CD,
levels = c(1, 2, 3, 4, 5, 6, 7, 8, 9),
labels = c(
"New England",
"Middle Atlantic",
"South Atlantic",
"East North Central",
"East South Central",
"West North Central",
"West South Central",
"Mountain",
"Pacific"
)
)
var_label(df$FACILITY_LOCATION_CD) <- "Facility Location"
summary(df$FACILITY_LOCATION_CD)
df$PUF_MULT_SOURCE
df$PUF_MULT_SOURCE <-
factor(
df$PUF_MULT_SOURCE,
levels = c(0, 1),
labels = c(
'Only one CoC facility reported this case to NCDB',
'Records pertaining to this case submitted to NCDB by more than one CoC facility'
)
)
var_label(df$PUF_MULT_SOURCE) <- "Patient Treated in More than One CoC Facility"
df$PUF_MULT_SOURCE
summary(df$PUF_MULT_SOURCE)
summary(df$REFERENCE_DATE_FLAG)
summary(as.factor(df$REFERENCE_DATE_FLAG))
summary(as.factor(df$AGE))
summary(as.factor(df$SEX))
summary(as.factor(df$RACE))
df$RACE <-
factor(
df$RACE,
levels = c(1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12, 13, 14, 15, 16, 17, 20, 21, 22, 25, 26, 27, 28, 30, 31, 32, 96, 97, 98, 99),
labels = c(
"White",
"Black",
"American Indian, Aleutian, or Eskimo",
"Chinese",
"Japanese",
"Filipino",
"Hawaiian",
"Korean",
"Vietnamese",
"Laotian",
"Hmong",
"Kampuchean (including Khmer and Cambodian)",
"Thai",
"Asian Indian or Pakistani, NOS (formerly code 09)",
"Asian Indian",
"Pakistani",
"Micronesian, NOS",
"Chamorran",
"Guamanian, NOS",
"Polynesian, NOS",
"Tahitian",
"Samoan",
"Tongan",
"Melanesian, NOS",
"Fiji Islander",
"New Guinean",
"Other Asian, including Asian, NOS and Oriental, NOS",
"Pacific Islander, NOS",
"Other",
"Unknow"
)
)
var_label(df$RACE) <- "Race"
df$RACE <-
factor(
df$RACE,
levels = c(1, 2, 3, 4, 5, 6, 7, 8, 10, 11, 12, 13, 14, 15, 16, 17, 20, 21, 22, 25, 26, 27, 28, 30, 31, 32, 96, 97, 98, 99),
labels = c(
"White",
"Black",
"American Indian, Aleutian, or Eskimo",
"Chinese",
"Japanese",
"Filipino",
"Hawaiian",
"Korean",
"Vietnamese",
"Laotian",
"Hmong",
"Kampuchean (including Khmer and Cambodian)",
"Thai",
"Asian Indian or Pakistani, NOS (formerly code 09)",
"Asian Indian",
"Pakistani",
"Micronesian, NOS",
"Chamorran",
"Guamanian, NOS",
"Polynesian, NOS",
"Tahitian",
"Samoan",
"Tongan",
"Melanesian, NOS",
"Fiji Islander",
"New Guinean",
"Other Asian, including Asian, NOS and Oriental, NOS",
"Pacific Islander, NOS",
"Other",
"Unknown"
)
)
var_label(df$RACE) <- "Race"
summary(df$RACE)
df$SPANISH_HISPANIC_ORIGIN <-
factor(
df$SPANISH_HISPANIC_ORIGIN,
levels = c(0, 1, 2, 3, 4, 5, 6, 7, 8, 9),
labels = c(
"Non-Spanish余 non-Hispanic",
"Mexican (includes Chicano)",
"Puerto Rican",
"Cuban",
"South or Central America (except Brazil)",
"Other specified Spanish/Hispanic origin (includes European)",
"Spanish, NOS余 Hispanic, NOS余 Latino, NOS (There is evidence other than surname or maiden name that the person is Hispanic, but he/she cannot be assigned to any category of 1-5)",
"Spanish surname only (The only evidence of the person's Hispanic origin is surname or maiden name, and there is no contrary evidence that the person is not Hispanic)",
"Dominican Republic (for use with patients who were diagnosed with cancer on January 1, 2005, or later)",
"Unknown whether Spanish or not余 not stated in patient record"
)
)
var_label(df$SPANISH_HISPANIC_ORIGIN) <- "Spanish Origin"
summary(df$SPANISH_HISPANIC_ORIGIN)
df$INSURANCE_STATUS <-
factor(
df$INSURANCE_STATUS,
levels = c(0, 1, 2, 3, 4, 9),
labels = c(
"Not Insured",
"Private Insurance/Managed Care",
"Medicaid",
"Medicare",
"Other Government",
"Insurance Status unknown"
)
)
var_label(df$INSURANCE_STATUS) <- "Primary Payer"
summary(df$INSURANCE_STATUS)
df$MEDICAID_EXPN_CODE <-
factor(
df$MEDICAID_EXPN_CODE,
levels = c(0, 1, 2, 3, 9),
labels = c("Non-Expansion States",
"January 2014 Expansion States",
"Early Expansion States (2010 - 2013)",
"Late Expansion States (after Jan 2014)",
"Supporessed for Ages 0-39")
)
var_label(df$MEDICAID_EXPN_CODE) <- "Medicaid Expansion Status State Group"
summary(df$MEDICAID_EXPN_CODE)
df$MEDICAID_EXPN_CODE <-
factor(
df$MEDICAID_EXPN_CODE,
levels = c(0, 1, 2, 3, 9),
labels = c("Non-Expansion States",
"January 2014 Expansion States",
"Early Expansion States (2010 - 2013)",
"Late Expansion States (after Jan 2014)",
"Suppressed for Ages 0-39")
)
var_label(df$MEDICAID_EXPN_CODE) <- "Medicaid Expansion Status State Group"
summary(df$MEDICAID_EXPN_CODE)
#MED_INC_QUAR_00
# Median household income for each patient's area of residence is estimated by
# matching the zip code of the patient recorded at the time of diagnosis against files
# derived from year 2000 US Census data. Household income is categorized as
# quartiles based on equally proportioned income ranges among all US zip codes.
df$MED_INC_QUAR_00 <-
factor(
df$MED_INC_QUAR_00,
levels = c(1, 2, 3, 4),
labels = c(
"Less than $30,000",
"$30,000-$34,000",
"$35,000-$45,999",
"$46,000 or more"
)
)
var_label(df$MED_INC_QUAR_00) <- "Median Income by Zip Code"
summary(df$MED_INC_QUAR_00)
summary(df$NO_HSD_QUAR_00)
summary(as.factor(df$NO_HSD_QUAR_00))
df$NO_HSD_QUAR_00 <-
factor(
df$NO_HSD_QUAR_00,
levels = c(1, 2, 3, 4),
labels = c("29% or more",
"20% - 28.9%",
"14% - 19.9%",
"Less than 14%")
)
var_label(df$NO_HSD_QUAR_00) <- "Education 2000"
summary(as.factor(df$NO_HSD_QUAR_00))
df$UR_CD_03 <-
factor(
df$UR_CD_03,
levels = c(1, 2, 3, 4, 5, 6, 7, 8, 9),
labels = c(
"Counties in metro areas of 1 million population or more",
"Counties in metro areas of 250,000 to 1 million population",
"Counties in metro areas of fewer than 250,000 population",
"Urban population of 20,000 or more, adjacent to a metro area.",
"Urban population of 20,000 or more, not adjacent to a metro area.",
"Urban population of 2,500 to 19,999, adjacent to a metro area.",
"Urban population of 2,500 to 19,999, not adjacent to a metro area.",
"Completely rural or less than 2,500 urban population, adjacent to a metro area",
"Completely rural or less than 2,500 urban population, not adjacent to a metro area"
)
)
var_label(df$UR_CD_03) <- "Urban/Rural 2003"
summary(as.factor(df$UR_CD_03))
df$UR_CD_03 <-
factor(
df$UR_CD_03,
levels = c(1, 2, 3, 4, 5, 6, 7, 8, 9),
labels = c(
# Metro counties
"Counties in metro areas of 1 million population or more",
"Counties in metro areas of 250,000 to 1 million population",
"Counties in metro areas of fewer than 250,000 population",
# Urban Counties
"Urban population of 20,000 or more, adjacent to a metro area.",
"Urban population of 20,000 or more, not adjacent to a metro area.",
"Urban population of 2,500 to 19,999, adjacent to a metro area.",
"Urban population of 2,500 to 19,999, not adjacent to a metro area.",
# Rural Counties
"Completely rural or less than 2,500 urban population, adjacent to a metro area",
"Completely rural or less than 2,500 urban population, not adjacent to a metro area"
)
)
var_label(df$UR_CD_03) <- "Urban/Rural 2003"
summary(as.factor(df$UR_CD_03))
df$MED_INC_QUAR_12 <-
factor(
df$MED_INC_QUAR_12,
levels = c(1, 2, 3, 4),
labels = c(
"Less than $38,000",
"$38,000-$47,999",
"$48,000-$62,999",
"$63,000 or more"
)
)
var_label(df$MED_INC_QUAR_12) <- "Income 2008-2012"
df$NO_HSD_QUAR_12 <-
factor(
df$NO_HSD_QUAR_12,
levels = c(1, 2, 3, 4),
labels = c("21% or more",
"13%-20.9%",
"7%-12.9%",
"Less than 7%")
)
var_label(df$NO_HSD_QUAR_12) <- "Education 2008-2012"
df$MED_INC_QUAR_16
df$MED_INC_QUAR_16 <-
factor(
df$MED_INC_QUAR_16,
levels = c(1, 2, 3, 4),
labels = c(
"Less than $40,227",
"$40,227 - $50,353",
"$50,354 - $63,332",
"63,333+")
)
var_label(df$MED_INC_QUAR_16) <- "Income 2012-2016"
summary(df$MED_INC_QUAR_16)
df$UR_CD_13 <-
factor(
df$UR_CD_13,
levels = c(1, 2, 3, 4, 5, 6, 7, 8, 9),
labels = c(
# Metro counties
"Metro areas >= 1 million",
"Metro areas of 250,000 to 1 million",
"Metro areas of fewer than 250,000",
# Urban Counties
"Urban areas of 20,000 or more, adjacent to a metro area.",
"Urban population of 20,000 or more, not adjacent to a metro area.",
"Urban population of 2,500 to 19,999, adjacent to a metro area.",
"Urban population of 2,500 to 19,999, not adjacent to a metro area.",
# Rural Counties
"Completely rural or less than 2,500 urban population, adjacent to a metro area",
"Completely rural or less than 2,500 urban population, not adjacent to a metro area"
)
)
var_label(df$UR_CD_03) <- "Urban/Rural 2013"
summary(df$UR_CD_13)
df$URBAN_RURAL <- NA
df$URBAN_RURAL[df$UR_CD_13 %in% c(
"Metro areas >= 1 million",
"Metro areas of 250,000 to 1 million",
"Metro areas of fewer than 250,000"
)] <- 0
df$URBAN_RURAL[df$UR_CD_13 %in% c(
"Urban areas of 20,000 or more, adjacent to a metro area.",
"Urban population of 20,000 or more, not adjacent to a metro area.",
"Urban population of 2,500 to 19,999, adjacent to a metro area.",
"Urban population of 2,500 to 19,999, not adjacent to a metro area."
)] <- 1
df$URBAN_RURAL[df$UR_CD_13 %in% c(
"Completely rural or less than 2,500 urban population, adjacent to a metro area",
"Completely rural or less than 2,500 urban population, not adjacent to a metro area"
)] <- 2
df$URBAN_RURAL <-
factor(
df$URBAN_RURAL,
levels = c(0, 1, 2),
labels = c("Metro",
"Urban",
"Rural")
)
var_label(df$URBAN_RURAL) <- "Rurality"
summary(df$URBAN_RURAL)
df$NO_HSD_QUAR_16 <-
factor(
df$NO_HSD_QUAR_16,
levels = c(1, 2, 3, 4),
labels = c("17.6% or more",
"10.9% - 17.5%",
"6.3% - 10.8%",
"Less than 6.3%")
)
var_label(df$NO_HSD_QUAR_16) <- "Education 2012-2016"
summary(df$NO_HSD_QUAR_16)
summary(df$CROWFLY)
df$CDCC_TOTAL_BEST <-
factor(
df$CDCC_TOTAL_BEST,
levels = c(0, 1, 2, 3),
labels = c(
"Total Charlson Score of 0",
"Total Charlson score of 1",
"Total Charlson score of 2",
"Total Charlson score of 3 or more"
)
)
var_label(df$CDCC_TOTAL_BEST) <- "Charlson/Deyo Score"
summary(df$CDCC_TOTAL_BEST
)
summary(as.factor(df$SEQUENCE_NUMBER))
